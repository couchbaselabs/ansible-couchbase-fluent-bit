---
- name: Add Splunk
  block:
    - name: "Add Splunk to {{ fluent_bit_conf_file }}"
      ansible.builtin.lineinfile:
        path: "{{ fluent_bit_conf_dir }}/{{ fluent_bit_conf_file }}"
        state: present
        line: "@include {{ fluent_bit_conf_dir }}/couchbase/output/out-splunk.conf"

    - name: Copy Splunk Output conf file
      ansible.builtin.copy:
        src: "conf/couchbase/output/out-splunk.conf"
        dest: "{{ fluent_bit_conf_dir }}/couchbase/output/out-splunk.conf"
        owner: "{{ fluent_bit_user }}"
        group: "{{ fluent_bit_user_group }}"
        mode: 0664

  when: fluent_bit_splunk_enabled

- name: Remove Splunk
  block:
    - name: "Remove Splunk from {{ fluent_bit_conf_file }}"
      ansible.builtin.lineinfile:
        path: "{{ fluent_bit_conf_dir }}/{{ fluent_bit_conf_file }}"
        state: absent
        line: "@include {{ fluent_bit_conf_dir }}/couchbase/output/out-splunk.conf"

    - name: Remove Splunk Output conf file
      ansible.builtin.file:
        path: "{{ fluent_bit_conf_dir }}/couchbase/output/out-splunk.conf"
        state: absent
      ignore_errors: true    # noqa ignore-errors

  when: not fluent_bit_splunk_enabled
